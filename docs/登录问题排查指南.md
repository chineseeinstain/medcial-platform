# 登录问题排查指南

## 常见问题及解决方案

### 1. 检查后端服务是否启动

**问题现象**：前端提示"无法连接到服务器"或"网络错误"

**解决步骤**：
1. 确认后端服务已启动（端口8080）
2. 访问 `http://localhost:8080/api/auth/login` 测试接口是否可用
3. 检查后端控制台是否有错误日志

**验证命令**：
```bash
# Windows PowerShell
curl http://localhost:8080/api/auth/login -Method POST -ContentType "application/json" -Body '{"username":"admin","password":"123456"}'
```

### 2. 检查数据库连接

**问题现象**：后端日志显示数据库连接失败

**解决步骤**：
1. 确认MySQL服务已启动
2. 检查 `application.yml` 中的数据库配置：
   - 数据库名：`medical_platform`
   - 用户名：`root`
   - 密码：`123456`（如果不同，请修改）
3. 确认数据库已初始化（运行了 `init_complete.sql`）

**验证SQL**：
```sql
USE medical_platform;
SELECT username, role, status FROM user WHERE username = 'admin';
```

### 3. 检查用户密码是否正确

**问题现象**：提示"用户名或密码错误"

**解决步骤**：
1. 确认数据库中用户密码是BCrypt加密的
2. 默认测试账号：
   - 管理员：`admin` / `123456`
   - 医生：`doctor1` / `123456`
   - 患者：`patient1` / `123456`

**重置密码SQL**（如果需要）：
```sql
-- 使用BCrypt加密密码"123456"
UPDATE user SET password = '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iwK8pJwC' WHERE username = 'admin';
```

### 4. 检查CORS跨域配置

**问题现象**：浏览器控制台显示CORS错误

**解决步骤**：
1. 确认 `CorsConfig.java` 配置正确
2. 检查前端请求URL是否正确（`/api/auth/login`）
3. 检查Vite代理配置（`vite.config.js`）

### 5. 检查前端请求格式

**问题现象**：请求发送但响应格式错误

**检查点**：
1. 打开浏览器开发者工具（F12）
2. 查看Network标签页中的请求
3. 检查：
   - 请求URL：`http://localhost:3000/api/auth/login`
   - 请求方法：`POST`
   - 请求头：`Content-Type: application/json`
   - 请求体：`{"username":"admin","password":"123456"}`

### 6. 检查后端日志

**查看日志位置**：
- 后端控制台输出
- 日志级别：`DEBUG`（在 `application.yml` 中配置）

**关键日志信息**：
```
收到登录请求: username=admin
开始验证用户: username=admin
找到用户: username=admin
密码验证结果: matches=true/false
用户登录成功: username=admin, role=admin
```

### 7. 常见错误码说明

| 错误码 | 含义 | 解决方案 |
|--------|------|----------|
| 404 | 接口不存在 | 检查后端服务是否启动，URL是否正确 |
| 500 | 服务器内部错误 | 查看后端日志，检查数据库连接 |
| 401 | 未授权 | 检查用户名密码是否正确 |
| 网络错误 | 无法连接 | 检查后端服务是否启动，端口是否正确 |

## 快速诊断步骤

1. **检查后端服务**
   ```bash
   # 访问健康检查接口
   curl http://localhost:8080/api/index/health
   ```

2. **检查数据库**
   ```sql
   SELECT COUNT(*) FROM user;
   SELECT username, role, status FROM user LIMIT 5;
   ```

3. **测试登录接口**
   ```bash
   curl -X POST http://localhost:8080/api/auth/login \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"123456"}'
   ```

4. **查看前端控制台**
   - 打开浏览器开发者工具（F12）
   - 查看Console和Network标签页
   - 检查错误信息和请求详情

## 如果问题仍未解决

1. 检查后端控制台的完整错误堆栈
2. 检查数据库中的用户数据是否正确
3. 确认所有依赖服务（MySQL、Redis）都已启动
4. 查看 `docs/错误修复说明.md` 获取更多帮助

