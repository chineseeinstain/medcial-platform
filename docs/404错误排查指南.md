# 404错误排查指南

## 问题现象
前端请求后端接口时返回404错误，提示"请求失败 (404)"

## 可能原因

### 1. 后端服务未启动 ⚠️ 最常见

**检查方法**：
1. 查看后端控制台是否有启动日志
2. 访问 `http://localhost:8080/health` 测试
3. 运行 `测试后端服务.bat` 脚本

**解决方法**：
```bash
# 进入后端目录
cd backend

# 启动后端服务（Maven）
mvn spring-boot:run

# 或者使用IDE启动 MedicalPlatformApplication.java
```

### 2. 后端启动失败

**检查方法**：
- 查看后端控制台的错误日志
- 常见错误：
  - 数据库连接失败
  - 端口8080被占用
  - 依赖缺失

**解决方法**：
1. **端口被占用**：
   ```bash
   # Windows PowerShell
   netstat -ano | findstr :8080
   # 找到PID后，结束进程
   taskkill /PID <PID> /F
   ```

2. **数据库连接失败**：
   - 检查MySQL服务是否启动
   - 检查 `application.yml` 中的数据库配置
   - 确认数据库 `medical_platform` 已创建

3. **依赖缺失**：
   ```bash
   cd backend
   mvn clean install
   ```

### 3. 路径不匹配

**检查路径映射**：

| 前端请求 | 后端路径 | 完整URL |
|---------|---------|---------|
| `/auth/login` | `/api/auth/login` | `http://localhost:8080/api/auth/login` |
| `/auth/register` | `/api/auth/register` | `http://localhost:8080/api/auth/register` |

**验证方法**：
```bash
# 测试登录接口
curl -X POST http://localhost:8080/api/auth/login ^
  -H "Content-Type: application/json" ^
  -d "{\"username\":\"admin\",\"password\":\"123456\"}"
```

### 4. Vite代理配置问题

**检查文件**：`frontend/vite.config.js`

**配置应该是**：
```javascript
server: {
  port: 3000,
  proxy: {
    '/api': {
      target: 'http://localhost:8080',
      changeOrigin: true
    }
  }
}
```

**验证方法**：
1. 确认前端服务运行在3000端口
2. 确认后端服务运行在8080端口
3. 检查浏览器Network标签页，看实际请求的URL

### 5. Spring Boot Context Path配置

**检查文件**：`backend/src/main/resources/application.yml`

**配置应该是**：
```yaml
server:
  port: 8080
  servlet:
    context-path: /
```

如果 `context-path` 不是 `/`，需要相应调整前端请求路径。

## 快速诊断步骤

### 步骤1：检查后端服务状态
```bash
# 访问健康检查接口
curl http://localhost:8080/health

# 应该返回：
# {"code":200,"message":"操作成功","data":{"status":"UP"},"timestamp":...}
```

### 步骤2：检查后端日志
查看后端控制台，确认：
- ✅ 看到 "Started MedicalPlatformApplication"
- ✅ 看到 "Tomcat started on port(s): 8080"
- ✅ 没有错误堆栈信息

### 步骤3：测试API接口
```bash
# 测试根路径
curl http://localhost:8080/

# 测试登录接口
curl -X POST http://localhost:8080/api/auth/login ^
  -H "Content-Type: application/json" ^
  -d "{\"username\":\"admin\",\"password\":\"123456\"}"
```

### 步骤4：检查浏览器Network
1. 打开浏览器开发者工具（F12）
2. 切换到Network标签页
3. 尝试登录
4. 查看请求详情：
   - **Request URL**: 应该是 `http://localhost:3000/api/auth/login`
   - **Status Code**: 如果是404，查看实际请求的URL
   - **Response**: 查看错误详情

## 常见错误示例

### 错误1：后端未启动
```
Network Error: Failed to fetch
或
请求失败 (404) - 无法连接到服务器
```
**解决**：启动后端服务

### 错误2：路径错误
```
Request URL: http://localhost:3000/auth/login
实际应该是: http://localhost:3000/api/auth/login
```
**解决**：检查前端请求URL，确保包含 `/api` 前缀

### 错误3：端口冲突
```
Port 8080 is already in use
```
**解决**：关闭占用8080端口的进程，或修改 `application.yml` 中的端口

## 验证清单

- [ ] 后端服务已启动（端口8080）
- [ ] 前端服务已启动（端口3000）
- [ ] MySQL服务已启动
- [ ] 数据库 `medical_platform` 已创建
- [ ] 可以访问 `http://localhost:8080/health`
- [ ] 可以访问 `http://localhost:8080/`
- [ ] Vite代理配置正确
- [ ] 浏览器Network中请求URL正确

## 如果问题仍未解决

1. **查看完整错误日志**：
   - 后端控制台完整输出
   - 浏览器Console和Network标签页

2. **运行诊断脚本**：
   ```bash
   测试后端服务.bat
   ```

3. **检查防火墙**：
   - 确认防火墙没有阻止8080端口
   - 确认本地回环地址可以访问

4. **重启服务**：
   ```bash
   # 停止所有服务
   # 重新启动后端
   # 重新启动前端
   ```

5. **查看详细文档**：
   - `docs/登录问题排查指南.md`
   - `docs/快速开始指南.md`

